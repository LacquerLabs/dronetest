kind: pipeline
type: docker
name: built-cli
steps:
  - name: check
    image: herbysk/drone-plugin-check-changes
    settings:
      ignore: [ "/**", "!/.drone.yml", "!/*.go" ]
      negative: .skip
  - name: compile
    image: golang:alpine
    commands:
      - if [ -f .skip ]; then exit; fi
      - go build
  - name: build-docker
    image: docker
    commands:
      - if [ -f .skip ]; then exit; fi
      - docker build -t dronetest/goapp .
    volumes:
      - name: docker_socket
        path: /var/run/docker.sock
  - name: deploy-compose
    image: docker/compose
    commands:
      - if [ -f .skip ]; then exit; fi
      - docker-compose up -d
    volumes:
      - name: docker_socket
        path: /var/run/docker.sock

volumes:
  - name: docker_socket
    host:
      path: /var/run/docker.sock